<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D ocument</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <button class="btn btn-primary mb-3" onclick="showAddModal()">Tambah User</button>
    <div class="row" id="wrap_user"></div>
  </div>

  <div class="modal fade" id="addModal" tabindex="-1" style="display:none;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Tambah User Baru</h5>
          <button type="button" class="close" onclick="hideAddModal()"><span>&times;</span></button>
        </div>
        <form id="addForm">
          <div class="modal-body">
            <div class="form-group"><label>Username</label><input type="text" class="form-control" name="username" required></div>
            <div class="form-group"><label>Password</label><input type="password" class="form-control" name="password" required></div>
            <div class="form-group"><label>Email</label><input type="email" class="form-control" name="email" required></div>
            <div class="form-group"><label>First Name</label><input type="text" class="form-control" name="first_name" required></div>
            <div class="form-group"><label>Last Name</label><input type="text" class="form-control" name="last_name" required></div>
            <div class="form-group"><label>Company</label><input type="text" class="form-control" name="company"></div>
            <div class="form-group"><label>Phone</label><input type="text" class="form-control" name="phone"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="hideAddModal()">Batal</button>
            <button type="submit" class="btn btn-primary">Simpan</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="editModal" tabindex="-1" style="display:none;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit User</h5>
          <button type="button" class="close" onclick="hideEditModal()"><span>&times;</span></button>
        </div>
        <form id="editForm">
          <input type="hidden" name="id" id="editId">
          <div class="modal-body">
            <div class="form-group"><label>Username</label><input type="text" class="form-control" name="username" id="editUsername" required></div>
            <div class="form-group"><label>Password</label><input type="password" class="form-control" name="password" id="editPassword" required></div>
            <div class="form-group"><label>Email</label><input type="email" class="form-control" name="email" id="editEmail" required></div>
            <div class="form-group"><label>First Name</label><input type="text" class="form-control" name="first_name" id="editFirstName" required></div>
            <div class="form-group"><label>Last Name</label><input type="text" class="form-control" name="last_name" id="editLastName" required></div>
            <div class="form-group"><label>Company</label><input type="text" class="form-control" name="company" id="editCompany"></div>
            <div class="form-group"><label>Phone</label><input type="text" class="form-control" name="phone" id="editPhone"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="hideEditModal()">Batal</button>
            <button type="submit" class="btn btn-primary">Update</button>
          </div>
        </form>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const wrapUser = document.getElementById('wrap_user');

  fetch('http://localhost/php-template/api_user_delete.php')
    .then(response => response.json())
    .then(respon => {
      respon.data.forEach(row => {
        const card = `
          <div class="col-md-4" id="user-${row.id}">
            <div class="card mb-3">
              <div class="card-header">${row.id}</div>
              <div class="card-body">
                <h5 class="card-title">${row.username}</h5>
                <p class="card-text">Email: ${row.email}</p>
                <p class="card-text">First: ${row.first_name}</p>
                <p class="card-text">Last: ${row.last_name}</p>
                <p class="card-text">Company: ${row.company}</p>
                <p class="card-text">Phone: ${row.phone}</p>
                <button class="btn btn-info btn-sm" onclick="showEditModal(${row.id}, '${row.username}', '${row.password}', '${row.email}', '${row.first_name}', '${row.last_name}', '${row.company}', '${row.phone}')">Edit</button>
                <button class="btn btn-danger btn-sm" onclick="deleteUser(${row.id})">Delete</button>
              </div>
            </div>
          </div>`;
        wrapUser.innerHTML += card;
      });
    });

  async function deleteUser(id) {
    const fd = new FormData();
    fd.append('id', id);
    const response = await fetch('http://localhost/php-template/api_user_delete.php', { method:'POST', body:fd });
    const result = await response.json();
    if(result.status){ document.getElementById(`user-${id}`).remove(); }
  }

  function showAddModal(){
    const modal = document.getElementById('addModal');
    modal.style.display='block'; modal.classList.add('show');
    const backdrop=document.createElement('div'); backdrop.className='modal-backdrop fade show';
    document.body.appendChild(backdrop); document.body.classList.add('modal-open');
  }
  function hideAddModal(){
    const modal=document.getElementById('addModal');
    modal.style.display='none'; modal.classList.remove('show');
    const backdrop=document.querySelector('.modal-backdrop'); if(backdrop) backdrop.remove();
    document.body.classList.remove('modal-open');
  }

  function showEditModal(id, username, password, email, first_name, last_name, company, phone){
    document.getElementById('editId').value=id;
    document.getElementById('editUsername').value=username;
    document.getElementById('editPassword').value=password;
    document.getElementById('editEmail').value=email;
    document.getElementById('editFirstName').value=first_name;
    document.getElementById('editLastName').value=last_name;
    document.getElementById('editCompany').value=company;
    document.getElementById('editPhone').value=phone;

    const modal=document.getElementById('editModal');
    modal.style.display='block'; modal.classList.add('show');
    const backdrop=document.createElement('div'); backdrop.className='modal-backdrop fade show';
    document.body.appendChild(backdrop); document.body.classList.add('modal-open');
  }
  function hideEditModal(){
    const modal=document.getElementById('editModal');
    modal.style.display='none'; modal.classList.remove('show');
    const backdrop=document.querySelector('.modal-backdrop'); if(backdrop) backdrop.remove();
    document.body.classList.remove('modal-open');
  }

  document.getElementById('addForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const fd=new FormData(this);
    const res=await fetch('http://localhost/php-template/api_user_add.php',{method:'POST',body:fd});
    const result=await res.json();
    if(result.status){ alert('User berhasil ditambah!'); hideAddModal(); this.reset(); location.reload(); }
    else{ alert('Gagal: '+result.message); }
  });

  document.getElementById('editForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const fd=new FormData(this);
    const res = await fetch('http://localhost/php-template/api_user_edit.php', { method:'POST', body:fd });
    const result = await res.json();
    if(result.status){
      alert('Data berhasil diupdate!');
      hideEditModal();
      this.reset();
      location.reload();
    } else {
      alert('Gagal: ' + result.message);
    }
  });
</script>
</body>
</html>